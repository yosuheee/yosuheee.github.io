<!DOCTYPE html>
<html>
  <head><title></title></head>
  <style>
    body {
      padding: 0;
      margin: 0;
    }
    #container {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 50% 50%;
      grid-template-rows: 100%;
    }
    textarea {
      padding: 1em;
      font-family: Roboto Mono for Powerline;
      font-size: 20px;
    }
  </style>
  <body>
    <div id="container">
      <textarea id="src" name="source">a + b + c;</textarea>
      <textarea id="dest" name="destination"></textarea>
    </div>
    <script>
      const resize = () => {
        document.getElementById("container").style.height = window.innerHeight + "px";
      };
      window.addEventListener("resize", resize);

      const src = document.getElementById("src");
      const dest = document.getElementById("dest");
      src.addEventListener("keydown", e => {
        if (e.code === "Tab") {
          e.preventDefault();
          const sentence = textarea.value;
          const len      = sentence.length;
          const pos      = textarea.selectionStart;
          const before   = sentence.substr(0, pos);
          const word     = "  ";
          const after    = sentence.substr(pos, len);
          textarea.value = before + word + after;
          textarea.selectionEnd = pos + word.length;
        }
      });
      const change = async source => {
        const response = await fetch("/parse", {
          method: "POST",
          body: source,
        });
        const text = await response.text();
        if (text === " ") {
          dest.value = "";
          return;
        }
        if (text.startsWith("(")) {
          dest.value = text;
        } else {
          const json = JSON.parse(text);
          dest.value = JSON.stringify(json, null, 2);
        }
      };
      src.addEventListener("keyup", e => change(e.target.value));
      resize();
      change(src.value);
    </script>
  </body>
</html>
